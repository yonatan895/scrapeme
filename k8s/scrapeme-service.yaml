# Service for ScrapeMe application
apiVersion: v1
kind: Service
metadata:
  name: scrapeme-app
  namespace: scrapeme
  labels:
    app.kubernetes.io/name: scrapeme
    app.kubernetes.io/component: scraper
  annotations:
    # Prometheus scraping configuration
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"
    # Service description
    service.alpha.kubernetes.io/description: "ScrapeMe Selenium automation framework metrics endpoint"
spec:
  selector:
    app: scrapeme
    component: scraper
  ports:
  - name: metrics
    port: 9090
    targetPort: 9090
    protocol: TCP
  type: ClusterIP
  # Session affinity for sticky sessions (optional)
  sessionAffinity: None

---
# LoadBalancer service for external access (optional)
# Uncomment if you need external access to metrics
# apiVersion: v1
# kind: Service
# metadata:
#   name: scrapeme-app-external
#   namespace: scrapeme
#   labels:
#     app.kubernetes.io/name: scrapeme
#     app.kubernetes.io/component: scraper
#   annotations:
#     # Cloud provider specific annotations
#     service.beta.kubernetes.io/aws-load-balancer-type: nlb  # AWS
#     service.beta.kubernetes.io/azure-load-balancer-internal: "false"  # Azure
# spec:
#   selector:
#     app: scrapeme
#     component: scraper
#   ports:
#   - name: metrics
#     port: 9090
#     targetPort: 9090
#     protocol: TCP
#   type: LoadBalancer
#   loadBalancerSourceRanges:
#   - "10.0.0.0/8"      # Restrict access to internal networks
#   - "172.16.0.0/12"
#   - "192.168.0.0/16"

---
# Headless service for direct pod access (monitoring/debugging)
apiVersion: v1
kind: Service
metadata:
  name: scrapeme-app-headless
  namespace: scrapeme
  labels:
    app.kubernetes.io/name: scrapeme
    app.kubernetes.io/component: scraper
  annotations:
    service.alpha.kubernetes.io/description: "Headless service for direct pod access"
spec:
  selector:
    app: scrapeme
    component: scraper
  ports:
  - name: metrics
    port: 9090
    targetPort: 9090
    protocol: TCP
  clusterIP: None  # Headless service
  type: ClusterIP

---
# Ingress for HTTP access (optional)
# Uncomment and configure for your ingress controller
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: scrapeme-app-ingress
#   namespace: scrapeme
#   labels:
#     app.kubernetes.io/name: scrapeme
#     app.kubernetes.io/component: scraper
#   annotations:
#     # Nginx ingress annotations
#     kubernetes.io/ingress.class: nginx
#     nginx.ingress.kubernetes.io/rewrite-target: /
#     nginx.ingress.kubernetes.io/ssl-redirect: "true"
#     # Rate limiting
#     nginx.ingress.kubernetes.io/rate-limit: "10"
#     # Authentication (optional)
#     # nginx.ingress.kubernetes.io/auth-type: basic
#     # nginx.ingress.kubernetes.io/auth-secret: basic-auth-secret
# spec:
#   tls:
#   - hosts:
#     - scrapeme.yourdomain.com
#     secretName: scrapeme-tls
#   rules:
#   - host: scrapeme.yourdomain.com
#     http:
#       paths:
#       - path: /metrics
#         pathType: Prefix
#         backend:
#           service:
#             name: scrapeme-app
#             port:
#               number: 9090
#       - path: /healthz
#         pathType: Exact
#         backend:
#           service:
#             name: scrapeme-app
#             port:
#               number: 9090
